{% extends "base.html" %}

{% block title %}System Status - Aye Chef{% endblock %}

{% block body %}
<div class="max-w-2xl mx-auto py-8 px-4">
    <!-- Header -->
    <header class="flex items-center justify-between mb-8">
        <div>
            <h1 class="font-display text-3xl text-primary">System Status</h1>
            <p class="text-muted mt-1">Prerequisites for meal planning</p>
        </div>
        <a href="/" class="text-accent hover:text-accent-hover font-medium">← Back</a>
    </header>

    <!-- Summary Banner -->
    {% if error_count > 0 %}
    <div class="card rounded-xl p-4 mb-6 border-l-4 border-error">
        <div class="flex items-center gap-3">
            <span class="w-10 h-10 rounded-full bg-error/20 flex items-center justify-center text-error text-lg">!</span>
            <div>
                <p class="font-semibold text-primary">{{ error_count }} issue{{ 's' if error_count != 1 else '' }} blocking meal planning</p>
                <p class="text-muted text-sm">Resolve the items below to enable meal planning</p>
            </div>
        </div>
    </div>
    {% elif warning_count > 0 %}
    <div class="card rounded-xl p-4 mb-6 border-l-4 border-warning">
        <div class="flex items-center gap-3">
            <span class="w-10 h-10 rounded-full bg-warning/20 flex items-center justify-center text-warning text-lg">!</span>
            <div>
                <p class="font-semibold text-primary">Ready with {{ warning_count }} recommendation{{ 's' if warning_count != 1 else '' }}</p>
                <p class="text-muted text-sm">Meal planning available, but some items could be improved</p>
            </div>
        </div>
    </div>
    {% else %}
    <div class="card rounded-xl p-4 mb-6 border-l-4 border-success">
        <div class="flex items-center gap-3">
            <span class="w-10 h-10 rounded-full bg-success/20 flex items-center justify-center text-success text-lg">✓</span>
            <div>
                <p class="font-semibold text-primary">All systems ready</p>
                <p class="text-muted text-sm">Everything is configured correctly</p>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Required Section -->
    <div class="mb-8">
        <h2 class="text-xs font-semibold text-muted uppercase tracking-wide mb-3 px-1">
            Required for Meal Planning
        </h2>
        <div class="card rounded-xl divide-y divide-border">
            
            <!-- Config File -->
            {% set check = checks.config %}
            <div class="p-4">
                <div class="flex items-center gap-3">
                    {% if check.status == 'ok' %}
                    <span class="w-8 h-8 rounded-full bg-success/20 flex items-center justify-center text-success flex-shrink-0">✓</span>
                    {% elif check.status == 'warning' %}
                    <span class="w-8 h-8 rounded-full bg-warning/20 flex items-center justify-center text-warning flex-shrink-0">!</span>
                    {% else %}
                    <span class="w-8 h-8 rounded-full bg-error/20 flex items-center justify-center text-error flex-shrink-0">✕</span>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-primary">Configuration</p>
                        <p class="text-sm text-muted truncate">{{ check.message }}</p>
                    </div>
                </div>
                {% if check.status != 'ok' and check.fix %}
                <div class="mt-3 ml-11 p-3 bg-subtle rounded-lg">
                    <p class="text-sm text-muted">{{ check.fix }}</p>
                </div>
                {% endif %}
            </div>

            <!-- Mealie Connection -->
            {% set check = checks.mealie %}
            <div class="p-4">
                <div class="flex items-center gap-3">
                    {% if check.status == 'ok' %}
                    <span class="w-8 h-8 rounded-full bg-success/20 flex items-center justify-center text-success flex-shrink-0">✓</span>
                    {% elif check.status == 'warning' %}
                    <span class="w-8 h-8 rounded-full bg-warning/20 flex items-center justify-center text-warning flex-shrink-0">!</span>
                    {% else %}
                    <span class="w-8 h-8 rounded-full bg-error/20 flex items-center justify-center text-error flex-shrink-0">✕</span>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-primary">Mealie Connection</p>
                        <p class="text-sm text-muted truncate">{{ check.message }}</p>
                    </div>
                </div>
                {% if check.status != 'ok' and check.fix %}
                <div class="mt-3 ml-11 p-3 bg-subtle rounded-lg">
                    <p class="text-sm text-muted">{{ check.fix }}</p>
                    {% if check.status == 'error' %}
                    <a href="/#settings" class="inline-block mt-2 text-accent hover:text-accent-hover text-sm font-medium">
                        Go to Settings →
                    </a>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <!-- OpenRouter API -->
            {% set check = checks.openrouter %}
            <div class="p-4">
                <div class="flex items-center gap-3">
                    {% if check.status == 'ok' %}
                    <span class="w-8 h-8 rounded-full bg-success/20 flex items-center justify-center text-success flex-shrink-0">✓</span>
                    {% elif check.status == 'warning' %}
                    <span class="w-8 h-8 rounded-full bg-warning/20 flex items-center justify-center text-warning flex-shrink-0">!</span>
                    {% else %}
                    <span class="w-8 h-8 rounded-full bg-error/20 flex items-center justify-center text-error flex-shrink-0">✕</span>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-primary">AI Service (OpenRouter)</p>
                        <p class="text-sm text-muted truncate">{{ check.message }}</p>
                    </div>
                </div>
                {% if check.status != 'ok' and check.fix %}
                <div class="mt-3 ml-11 p-3 bg-subtle rounded-lg">
                    <p class="text-sm text-muted">{{ check.fix }}</p>
                    {% if check.status == 'error' %}
                    <div class="flex gap-4 mt-2">
                        <a href="/#settings" class="text-accent hover:text-accent-hover text-sm font-medium">
                            Go to Settings →
                        </a>
                        <a href="https://openrouter.ai/keys" target="_blank" 
                           class="text-accent hover:text-accent-hover text-sm font-medium">
                            Get API key →
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <!-- Recipe Index -->
            {% set check = checks.index %}
            <div class="p-4">
                <div class="flex items-center gap-3">
                    {% if check.status == 'ok' %}
                    <span class="w-8 h-8 rounded-full bg-success/20 flex items-center justify-center text-success flex-shrink-0">✓</span>
                    {% elif check.status == 'warning' %}
                    <span class="w-8 h-8 rounded-full bg-warning/20 flex items-center justify-center text-warning flex-shrink-0">!</span>
                    {% else %}
                    <span class="w-8 h-8 rounded-full bg-error/20 flex items-center justify-center text-error flex-shrink-0">✕</span>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-primary">Recipe Index</p>
                        <p class="text-sm text-muted truncate">{{ check.message }}</p>
                    </div>
                </div>
                {% if check.status != 'ok' and check.fix %}
                <div class="mt-3 ml-11 p-3 bg-subtle rounded-lg">
                    <p class="text-sm text-muted">{{ check.fix }}</p>
                </div>
                {% endif %}
            </div>

            <!-- Cuisine Distribution (NEW) -->
            {% set check = checks.cuisine %}
            <div class="p-4">
                <div class="flex items-center gap-3">
                    {% if check.status == 'ok' %}
                    <span class="w-8 h-8 rounded-full bg-success/20 flex items-center justify-center text-success flex-shrink-0">✓</span>
                    {% elif check.status == 'warning' %}
                    <span class="w-8 h-8 rounded-full bg-warning/20 flex items-center justify-center text-warning flex-shrink-0">!</span>
                    {% else %}
                    <span class="w-8 h-8 rounded-full bg-error/20 flex items-center justify-center text-error flex-shrink-0">✕</span>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-primary">Cuisine Ready</p>
                        <p class="text-sm text-muted truncate">{{ check.message }}</p>
                    </div>
                    {% if check.status == 'ok' %}
                    <a href="/insights" class="text-accent hover:text-accent-hover text-sm font-medium flex-shrink-0">
                        View Insights →
                    </a>
                    {% endif %}
                </div>
                {% if check.status != 'ok' and check.fix %}
                <div class="mt-3 ml-11 p-3 bg-subtle rounded-lg">
                    <p class="text-sm text-muted">{{ check.fix }}</p>
                    <form action="/maintenance/repair_optimize" method="POST" class="inline">
                        <button type="submit" class="mt-2 text-accent hover:text-accent-hover text-sm font-medium">
                            Run Maintenance →
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>

        </div>
    </div>

    <!-- Recommended Section -->
    <div class="mb-8">
        <h2 class="text-xs font-semibold text-muted uppercase tracking-wide mb-3 px-1">
            Recommended
        </h2>
        <div class="card rounded-xl divide-y divide-border">
            
            <!-- Embedding Model -->
            {% set check = checks.embedding %}
            <div class="p-4">
                <div class="flex items-center gap-3">
                    {% if check.status == 'ok' %}
                    <span class="w-8 h-8 rounded-full bg-success/20 flex items-center justify-center text-success flex-shrink-0">✓</span>
                    {% elif check.status == 'warning' %}
                    <span class="w-8 h-8 rounded-full bg-warning/20 flex items-center justify-center text-warning flex-shrink-0">!</span>
                    {% else %}
                    <span class="w-8 h-8 rounded-full bg-error/20 flex items-center justify-center text-error flex-shrink-0">✕</span>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-primary">Smart Recipe Search</p>
                        <p class="text-sm text-muted truncate">{{ check.message }}</p>
                    </div>
                </div>
                {% if check.status != 'ok' and check.fix %}
                <div class="mt-3 ml-11 p-3 bg-subtle rounded-lg">
                    <p class="text-sm text-muted">{{ check.fix }}</p>
                </div>
                {% endif %}
            </div>

            <!-- Recipe Quality -->
            {% set check = checks.recipe_quality %}
            <div class="p-4">
                <div class="flex items-center gap-3">
                    {% if check.status == 'ok' %}
                    <span class="w-8 h-8 rounded-full bg-success/20 flex items-center justify-center text-success flex-shrink-0">✓</span>
                    {% elif check.status == 'warning' %}
                    <span class="w-8 h-8 rounded-full bg-warning/20 flex items-center justify-center text-warning flex-shrink-0">!</span>
                    {% else %}
                    <span class="w-8 h-8 rounded-full bg-error/20 flex items-center justify-center text-error flex-shrink-0">✕</span>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-primary">Recipe Quality</p>
                        <p class="text-sm text-muted truncate">{{ check.message }}</p>
                    </div>
                </div>
                {% if check.status != 'ok' and check.fix %}
                <div class="mt-3 ml-11 p-3 bg-subtle rounded-lg">
                    <p class="text-sm text-muted">{{ check.fix }}</p>
                    <form action="/maintenance/repair_optimize" method="POST" class="inline">
                        <button type="submit" class="mt-2 text-accent hover:text-accent-hover text-sm font-medium">
                            Run Maintenance →
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>

            <!-- Mealie Tags (NEW) -->
            {% set check = checks.mealie_tags %}
            <div class="p-4">
                <div class="flex items-center gap-3">
                    {% if check.status == 'ok' %}
                    <span class="w-8 h-8 rounded-full bg-success/20 flex items-center justify-center text-success flex-shrink-0">✓</span>
                    {% elif check.status == 'warning' %}
                    <span class="w-8 h-8 rounded-full bg-warning/20 flex items-center justify-center text-warning flex-shrink-0">!</span>
                    {% else %}
                    <span class="w-8 h-8 rounded-full bg-error/20 flex items-center justify-center text-error flex-shrink-0">✕</span>
                    {% endif %}
                    <div class="flex-1 min-w-0">
                        <p class="font-medium text-primary">Mealie Tags</p>
                        <p class="text-sm text-muted truncate">{{ check.message }}</p>
                    </div>
                </div>
                {% if check.status != 'ok' and check.fix %}
                <div class="mt-3 ml-11 p-3 bg-subtle rounded-lg">
                    <p class="text-sm text-muted">{{ check.fix }}</p>
                    <form action="/status/seed-tags" method="POST" class="inline">
                        <button type="submit" class="mt-2 text-accent hover:text-accent-hover text-sm font-medium">
                            Seed Tags →
                        </button>
                    </form>
                </div>
                {% endif %}
            </div>

        </div>
    </div>

    <!-- Refresh Button -->
    <div class="text-center">
        <button onclick="location.reload()" 
                class="text-accent hover:text-accent-hover font-medium">
            ↻ Refresh checks
        </button>
    </div>

</div>
{% endblock %}
